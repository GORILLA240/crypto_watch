---
inclusion: always
---

# プロダクト概要

Crypto Watchは暗号通貨価格監視アプリケーションで、スマートウォッチクライアント向けに最適化されています。

## アーキテクチャ

**フロントエンド**: Flutterクロスプラットフォームアプリ（iOS、Android、Web、デスクトップ）
**バックエンド**: AWSサーバーレス（API Gateway + Lambda + DynamoDB）

## コア機能

### 価格追跡
- 20種類以上の主要暗号通貨（BTC、ETH、ADA等）をサポート
- 5分間隔の自動価格更新（EventBridgeスケジューラー）
- DynamoDBによる価格データキャッシング（TTL: 300秒）

### API設計原則
- スマートウォッチ最適化: 最小ペイロード、gzip圧縮必須
- APIキー認証必須（X-API-Keyヘッダー）
- レート制限: 100リクエスト/分/キー
- エンドポイント: `/prices?symbols=BTC,ETH`、`/health`

### 環境管理
- 3環境: dev、staging、production
- 環境ごとに独立したリソース（DynamoDB、Lambda、API Gateway）
- 環境固有の設定: `samconfig-{env}.toml`

## 設計制約

### パフォーマンス
- APIレスポンスは最小限に保つ（スマートウォッチ帯域幅制限）
- キャッシュファーストアプローチ（新鮮なデータがあれば外部API呼び出しをスキップ）
- Lambda関数は軽量に保つ（コールドスタート最小化）

### セキュリティ
- すべてのAPIエンドポイントはAPIキー認証が必要（/healthを除く）
- レート制限でDDoS攻撃を防止
- 環境変数で機密情報を管理

### スケーラビリティ
- サーバーレスアーキテクチャで自動スケーリング
- DynamoDBオンデマンドキャパシティ
- CloudWatch監視とアラーム

## 開発ガイドライン

### 新機能追加時
- フロントエンド: `lib/features/`に機能別フォルダを作成
- バックエンド: 共有ロジックは`src/shared/`、関数固有は`src/{function}/`
- 両方: テストを必ず追加（ユニット、統合、プロパティベース）

### API変更時
- バックエンドを先にデプロイ（後方互換性を保つ）
- APIバージョニングは現在未実装（破壊的変更は慎重に）
- ドキュメントを更新（README.md、API_KEY_MANAGEMENT.md等）

### デプロイ順序
1. dev環境でテスト
2. staging環境で検証
3. production環境へプロモート
4. ロールバック手順を常に準備
