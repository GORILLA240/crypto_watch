# 実装計画

- [x] 1. プロジェクト構造とコア機能のセットアップ





  - プロジェクトのディレクトリ構造を作成
  - 依存関係をpubspec.yamlに追加
  - 定数ファイル（api_constants.dart、app_constants.dart）を作成
  - _要件: 6.1, 8.1_

- [x] 1.1 エラーハンドリングの実装


  - カスタム例外クラス（exceptions.dart）を実装
  - Failureクラス（failures.dart）を実装
  - _要件: 4.2, 4.3, 4.4_

- [x] 1.2 ネットワーク層の実装


  - APIクライアント（api_client.dart）を実装
  - ネットワーク状態チェック（network_info.dart）を実装
  - HTTPヘッダー、タイムアウト、エラーハンドリングを含める
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 1.3 ローカルストレージの実装


  - SharedPreferencesラッパー（local_storage.dart）を実装
  - flutter_secure_storageの初期化
  - _要件: 8.1, 11.4_

- [x] 1.4 ユーティリティの実装


  - 通貨フォーマッター（currency_formatter.dart）を実装
  - 日付フォーマッター（date_formatter.dart）を実装
  - _要件: 1.5, 15.3_

- [x] 2. データモデルの実装



  - CryptoPriceモデルクラスを実装
  - fromJson/toJsonメソッドを実装
  - イミュータブルなフィールドを確保
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 2.1 データモデルのプロパティテストを作成


  - **プロパティ1: 価格データの一貫性**
  - **検証: 要件1.1, 1.2**

- [x] 2.2 PriceDetailモデルクラスを実装

  - CryptoPriceを拡張
  - 高値、安値、出来高、チャートデータを含める
  - _要件: 12.2, 12.3_

- [x] 2.3 Favoriteモデルクラスを実装

  - シンボル、順序、追加日時を含める
  - _要件: 11.1, 11.3_

- [x] 2.4 PriceAlertモデルクラスを実装

  - ID、シンボル、上限/下限、有効フラグを含める
  - _要件: 16.1, 16.2_

- [x] 2.5 AppSettingsモデルクラスを実装

  - 表示通貨、自動更新設定、通知設定を含める
  - _要件: 15.1, 15.2, 3.1_

- [x] 3. データソースの実装


  - PriceRemoteDataSourceを実装
  - APIクライアントを使用して価格データを取得
  - エラーハンドリングとタイムアウト処理を含める
  - _要件: 1.1, 6.2, 6.3, 6.4, 6.5_

- [x] 3.1 PriceLocalDataSourceを実装


  - SharedPreferencesを使用してキャッシュを管理
  - _要件: 8.1_

- [x] 3.2 FavoritesLocalDataSourceを実装


  - お気に入りリストの保存と読み込み
  - 並び替えデータの永続化
  - _要件: 11.4_

- [x] 3.3 お気に入りのプロパティテストを作成


  - **プロパティ2: お気に入りの順序保持**
  - **検証: 要件11.3, 11.4**

- [x] 3.4 AlertsLocalDataSourceを実装


  - アラート設定の保存と読み込み
  - _要件: 16.1, 16.2_

- [x] 3.5 SettingsLocalDataSourceを実装


  - アプリ設定の保存と読み込み
  - _要件: 15.4, 8.4_

- [x] 3.6 ローカルストレージのプロパティテストを作成


  - **プロパティ8: ローカルストレージの永続性**
  - **検証: 要件11.4, 15.4**

- [x] 4. リポジトリの実装



  - PriceRepositoryインターフェースを定義
  - PriceRepositoryImplを実装
  - Either型を使用してエラーハンドリング
  - _要件: 1.1, 2.1, 4.1, 4.2_

- [x] 4.1 リフレッシュのプロパティテストを作成

  - **プロパティ3: リフレッシュの冪等性**
  - **検証: 要件2.5**

- [x] 4.2 FavoritesRepositoryImplを実装

  - お気に入りの追加、削除、並び替え機能
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [x] 4.3 AlertsRepositoryImplを実装

  - アラートの作成、削除、更新機能
  - _要件: 16.1, 16.2, 16.5_

- [x] 4.4 SettingsRepositoryImplを実装

  - 設定の取得と更新機能
  - _要件: 15.1, 15.2, 15.4_

- [x] 5. ユースケースの実装



  - GetPricesユースケースを実装
  - RefreshPricesユースケースを実装
  - 各ユースケースは単一責任を持つ
  - _要件: 1.1, 2.1, 2.2_

- [x] 5.1 お気に入り関連ユースケースを実装


  - AddFavorite、RemoveFavorite、GetFavorites、ReorderFavoritesを実装
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [x] 5.2 アラート関連ユースケースを実装


  - CreateAlert、DeleteAlert、CheckAlertsを実装
  - _要件: 16.1, 16.2, 16.5_

- [x] 5.3 アラートのプロパティテストを作成

  - **プロパティ5: アラート発火の正確性**
  - **検証: 要件16.3**

- [x] 5.4 設定関連ユースケースを実装


  - GetSettings、UpdateSettingsを実装
  - _要件: 15.1, 15.2, 15.4_

- [x] 5.5 通貨変換のプロパティテストを作成

  - **プロパティ4: 通貨変換の可逆性**
  - **検証: 要件15.3, 15.5**

- [x] 6. 依存性注入の設定


  - injection_container.dartを実装
  - GetItを使用してすべての依存関係を登録
  - シングルトンとファクトリーを適切に使い分ける
  - _要件: 6.1_

- [x] 7. Blocの実装 - PriceListBloc



  - PriceListEvent（LoadPrices、RefreshPrices、AutoRefresh）を定義
  - PriceListState（Initial、Loading、Loaded、Refreshing、Error）を定義
  - PriceListBlocを実装
  - _要件: 1.1, 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 7.1 PriceListBlocのユニットテストを作成

  - 状態遷移の検証
  - エラーハンドリングの検証
  - _要件: 1.1, 2.1, 4.1, 4.2_

- [x] 7.2 自動更新機能をBlocに実装

  - 30秒ごとの自動更新タイマー
  - アプリライフサイクルの監視
  - バックグラウンド時の停止、フォアグラウンド時の再開
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 7.3 自動更新のプロパティテストを作成

  - **プロパティ6: 自動更新の停止と再開**
  - **検証: 要件3.2, 3.3**

- [x] 7.4 FavoritesBlocを実装

  - イベントと状態を定義
  - お気に入りの追加、削除、並び替えロジック
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [x] 7.5 PriceDetailBlocを実装

  - 詳細データの取得と表示ロジック
  - _要件: 12.1, 12.2, 12.3, 12.4_

- [x] 7.6 AlertsBlocを実装

  - アラートの管理と通知ロジック
  - _要件: 16.1, 16.2, 16.3, 16.4, 16.5_

- [x] 7.7 SettingsBlocを実装

  - 設定の取得と更新ロジック
  - _要件: 15.1, 15.2, 15.3, 15.4_

- [x] 7.8 SingleViewBlocを実装

  - シングルビューモードの状態管理
  - スワイプによる銘柄切り替えロジック
  - _要件: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 8. UIウィジェットの実装 - 共通コンポーネント



  - LoadingIndicatorウィジェットを実装
  - ErrorMessageウィジェットを実装
  - _要件: 5.1, 5.2, 5.3, 5.4, 4.5_

- [x] 8.1 PriceListItemウィジェットを実装


  - ティッカー、価格、変動率を表示
  - 変動率の色分け（緑/赤）
  - 大きなフォントと十分な余白
  - _要件: 1.2, 1.3, 1.4, 1.5, 17.2, 17.4_

- [x] 8.2 変動率表示のプロパティテストを作成

  - **プロパティ10: 変動率の色表示の一貫性**
  - **検証: 要件1.3, 1.4**

- [x] 8.3 MiniChartウィジェットを実装


  - fl_chartを使用
  - 1時間、24時間、7日間のチャート表示
  - _要件: 12.3, 12.4_

- [x] 8.4 PriceStatsウィジェットを実装


  - 高値、安値、出来高の表示
  - _要件: 12.2_

- [x] 8.5 ReorderableFavoriteListウィジェットを実装


  - ドラッグ＆ドロップによる並び替え
  - 長押しで並び替えモード
  - _要件: 11.3_

- [x] 8.6 AlertFormウィジェットを実装



  - 上限/下限価格の入力フォーム
  - バリデーション
  - _要件: 16.1, 16.2_

- [x] 8.7 CurrencySelectorウィジェットを実装


  - JPY、USD、EUR、BTCの選択UI
  - _要件: 15.1, 15.2_

- [x] 8.8 LargePriceDisplayウィジェットを実装


  - シングルビュー用の大きな価格表示
  - _要件: 13.2, 13.3_


- [x] 9. 画面の実装 - PriceListPage


  - PriceListPageを実装
  - BlocProviderとBlocBuilderを使用
  - プルトゥリフレッシュ機能
  - リフレッシュボタン

  - _要件: 1.1, 2.1, 2.2, 2.3, 2.4, 17.1, 17.2, 17.3, 17.4, 17.5_

- [x] 9.1 PriceListPageのウィジェットテストを作成


  - レンダリングの検証

  - ユーザー操作の検証
  - _要件: 1.1, 2.1, 2.2_

- [x] 9.2 PriceDetailPageを実装

  - 詳細情報の表示
  - チャート期間の切り替え
  - お気に入り追加ボタン
  - アラート設定へのショートカット
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_



- [x] 9.3 SettingsPageを実装


  - 通貨選択
  - 自動更新設定
  - 通知設定
  - _要件: 15.1, 15.2, 8.1, 8.2_

- [x] 9.4 SingleViewPageを実装


  - 全画面表示
  - 左右スワイプによる銘柄切り替え
  - 大きなフォントとチャート
  - _要件: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 10. ナビゲーションとルーティングの実装


  - アプリ全体のルーティングを設定
  - 画面遷移のアニメーション
  - _要件: 12.1_



- [x] 11. テーマとスタイリングの実装

  - ダークテーマを定義
  - カラーパレットを設定

  - テキストスタイルを定義
  - _要件: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 12. パフォーマンス最適化の実装

  - ListView.builderを使用した遅延読み込み
  - CachedNetworkImageの設定
  - 不要な再描画の防止
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [x] 12.1 パフォーマンスのプロパティテストを作成



  - **プロパティ9: UI応答性の維持**
  - **検証: 要件5.5, 10.1**



- [x] 13. エラーハンドリングとリトライ機能の実装


  - エラーメッセージの表示
  - 再試行ボタンの実装
  - ネットワークエラー、APIエラー、認証エラー、レート制限エラーの処理
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_


- [x] 13.1 エラー回復のプロパティテストを作成

  - **プロパティ7: エラー後の回復**
  - **検証: 要件4.5**

- [x] 14. 通知機能の実装


  - プッシュ通知の設定
  - アラート発火時の通知送信
  - 通知タップ時の画面遷移
  - _要件: 16.3, 16.4_



- [x] 15. コンプリケーション対応（スマートウォッチ）


  - 小、中、大サイズのコンプリケーションを実装
  - 文字盤上での価格表示
  - タップ時のアプリ起動
  - _要件: 14.1, 14.2, 14.3, 14.4, 14.5_

- [x] 16. 統合とデバッグ




  - すべての機能を統合
  - エンドツーエンドテストの実行
  - バグ修正
  - _要件: すべて_

- [x] 16.1 統合テストを作成




  - 主要なユーザーフローのテスト
  - API統合のテスト
  - _要件: すべて_

- [x] 17. 最終チェックポイント - すべてのテストが通過することを確認




  - すべてのテストが通過することを確認し、問題があれば質問する
