# 変更履歴

## 2024-01-15 - 仕様改訂（第2版）

### 設計方針の明確化

#### CI/CDツールの決定
- **GitHub Actions**を主要なCI/CDツールとして採用
- AWS CodePipelineは代替案として設計書に記載
- 実装タスクはGitHub Actionsベースで進める

#### レスポンス最適化の方針確定
- **JSONキー名は可読性重視**で維持（`symbol`, `price`など）
- キー短縮は採用せず、以下で最適化:
  - 不要フィールドの排除
  - 数値精度の制限
  - gzip圧縮
- フィールド数が限定的（6フィールド）であり、キー短縮の効果は小さい
- gzip圧縮により繰り返されるキー名は効率的に圧縮される

#### 自動ロールバックの具体化
- **CloudWatch Alarms + CodeDeploy**の組み合わせで実装
- トラフィックシフト: Linear10PercentEvery1Minute
- ロールバックトリガー:
  - Lambda Errors > 5% for 2 minutes
  - API Gateway 5xx > 10% for 2 minutes
  - Lambda Throttles > 10 in 1 minute
- GitHub ActionsからSAM deploy → CodeDeployがトラフィック制御とロールバックを実行

---

## 2024-01-15 - 仕様改訂（第1版）

### 追加された要件

#### 要件2の明確化
- **2.3**: レスポンスペイロード最適化の詳細を明文化
  - 不要フィールドの排除
  - 数値精度の制限（価格: 小数点2桁、変動率: 小数点1桁）
  - オプションでJSONキーの短縮
  
- **2.5**: 圧縮条件の明確化
  - Accept-Encodingヘッダーによるgzip圧縮の条件を明示

#### 要件7の拡張
- **7.2**: CI/CDパイプラインの具体化（GitHub ActionsまたはAWS CodePipeline）
- **7.5**: 自動ロールバック機能の追加（ヘルスチェック失敗時）
- **7.6**: ステージング→本番昇格フローの追加
- **7.7**: デプロイプロセスとロールバック手順の文書化要件

### 設計書の拡張

#### ヘルスチェックエンドポイントの詳細化
- DynamoDB接続チェックの実装詳細
- 最終価格更新時刻の確認
- キャッシュ年齢の計算と報告
- 正常時（200）と異常時（503）のレスポンス例

#### レスポンス最適化の詳細化
- ペイロード削減戦略の5つの具体的手法
- レスポンスサイズの具体例（非圧縮/圧縮）
- 圧縮による削減率の目標値（60-70%）

#### CI/CDパイプラインの設計
- GitHub Actionsワークフローの構成
- 開発/ステージング/本番環境へのデプロイフロー
- 自動ロールバックの条件とトリガー
- ロールバック手順の詳細

#### テストポリシーの追加
- 実装完了の定義
- テスト作成のタイミングと順序
- テストカバレッジ目標
- テスト命名規則
- タスク完了チェックリスト

### 実装タスクの追加

#### タスク8の拡張
- レスポンス最適化とペイロード削減の実装
- 数値精度制限ロジック
- オプションのコンパクトモード

#### タスク10の拡張
- ヘルスチェックの詳細な実装要件
- 異常検知時の503レスポンス
- 将来的拡張としての外部APIチェック

#### 新規タスク17-21
- **タスク17**: CI/CDパイプラインの構築
- **タスク18**: ゼロダウンタイムデプロイの設定
- **タスク19**: 自動ロールバック機能の実装
- **タスク20**: ステージング→本番昇格フローの整備
- **タスク21**: テストポリシーとガイドラインの文書化

### 新規ドキュメント

#### CONTRIBUTING.md
- テストポリシーの詳細
- コーディング規約
- プルリクエストプロセス
- デプロイメントプロセス
- トラブルシューティングガイド

### 用語集の拡張
- CI/CD Pipeline
- Zero-Downtime Deployment
- Rollback
- Health Check
- Payload Optimization
- Traffic Shifting

## 実装への影響

### 既存タスクへの影響
- タスク8と10が拡張されましたが、既存の実装計画との互換性は維持されています
- 新規タスク（17-21）は既存タスクの完了後に実施可能

### 整合性の確認
- すべての新規要件は設計書とタスクリストに反映済み
- プロパティテストは既存の15個を維持
- 新規タスクは既存のアーキテクチャと整合

### 推奨される実装順序
1. タスク1-16: コア機能の実装（既存計画通り）
2. タスク17: CI/CDパイプラインの構築
3. タスク18-19: デプロイメント機能の実装
4. タスク20: 昇格フローの整備
5. タスク21: ドキュメント整備

## 次のステップ

1. 改訂された仕様のレビュー
2. タスク1から順次実装開始
3. 各タスク完了時にCONTRIBUTING.mdのチェックリストを使用
4. CI/CDパイプライン構築後、自動デプロイフローを検証
