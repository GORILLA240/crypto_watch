# 実装計画

- [x] 1. 表示密度の設定機能を実装





  - DisplayDensity enumとDisplayDensityConfigクラスを作成
  - DisplayDensityHelperユーティリティクラスを実装
  - 各密度設定の値（アイテム高さ、アイコンサイズ、フォントサイズ、パディング）を定義
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 1.1 表示密度の制約プロパティテストを作成


  - **Property 2: 表示密度の制約**
  - **Validates: 要件 2.3, 2.4, 2.5**
  - 各表示密度について、画面サイズとアイテム高さから計算される銘柄数が指定範囲内であることを確認

- [x] 2. 設定画面に表示密度オプションを追加




  - SettingsエンティティにdisplayDensityフィールドを追加
  - SettingsModelにdisplayDensityのシリアライゼーション/デシリアライゼーションを追加
  - 設定画面UIに表示密度選択ラジオボタンを追加
  - _要件: 2.1, 2.2_

- [x] 2.1 表示密度設定の永続化プロパティテストを作成


  - **Property 2: 表示密度の制約**（永続化部分）
  - **Validates: 要件 2.7, 9.2**
  - 表示密度を保存し、読み込んだ後も同じ値であることを確認

- [x] 3. 通貨アイコン表示機能を実装



  - CryptoIconウィジェットを作成
  - アイコンURL生成ロジックを実装
  - プレースホルダー表示ロジックを実装（ティッカーシンボルの頭文字）
  - cached_network_imageパッケージを使用してキャッシング機能を実装
  - _要件: 1.1, 1.2, 1.6, 1.7_

- [x] 3.1 アイコン表示の一貫性プロパティテストを作成


  - **Property 1: アイコン表示の一貫性**
  - **Validates: 要件 1.1, 1.2, 1.6**
  - すべての価格アイテムにアイコンまたはプレースホルダーが表示されることを確認



- [x] 3.2 アイコンキャッシュの効率性プロパティテストを作成





  - **Property 7: アイコンキャッシュの効率性**
  - **Validates: 要件 1.7, 6.2**
  - 一度読み込まれたアイコンがキャッシュから取得されることを確認

- [x] 4. PriceListItemウィジェットを拡張




  - 通貨アイコンを左端に追加
  - お気に入りアイコン（星）を右端に追加
  - 表示密度に応じたレイアウト調整を実装
  - isFavoriteプロパティを追加
  - displayDensityプロパティを追加
  - _要件: 1.2, 4.1, 4.3, 4.5, 5.1, 5.2, 5.3, 5.4_

- [x] 4.1 表示密度変更時のレイアウト調整プロパティテストを作成


  - **Property 10: 表示密度変更時のレイアウト調整**
  - **Validates: 要件 2.6, 2.8, 5.1, 5.2, 5.3**
  - 表示密度変更時、アイテム高さ、アイコンサイズ、フォントサイズが適切に調整されることを確認

- [x] 4.2 最小フォントサイズ制約プロパティテストを作成


  - **Property 10の一部: 最小フォントサイズ**
  - **Validates: 要件 5.5**
  - すべての表示密度でフォントサイズが12sp以上であることを確認

- [x] 5. 長押し操作によるお気に入り追加/削除機能を実装





  - PriceListItemにGestureDetectorを追加
  - onLongPressコールバックを実装
  - HapticFeedback.mediumImpact()で触覚フィードバックを提供
  - コンテキストメニュー（ModalBottomSheet）を表示
  - お気に入り状態に応じて「追加」または「削除」オプションを表示
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.9_

- [x] 5.1 お気に入り状態の同期プロパティテストを作成


  - **Property 3: お気に入り状態の同期**
  - **Validates: 要件 3.5, 3.7, 3.8**
  - お気に入り操作後、UIとストレージの状態が一致することを確認

- [x] 5.2 長押し操作の応答性プロパティテストを作成


  - **Property 5: 長押し操作の応答性**
  - **Validates: 要件 3.1, 6.3**
  - 長押し操作が500ms以内に触覚フィードバックを提供することを確認

- [x] 6. PriceListBlocを拡張してお気に入り操作をサポート





  - ToggleFavoriteEventを追加
  - お気に入り追加/削除のイベントハンドラーを実装
  - FavoritesRepositoryと連携
  - 状態にfavoriteSymbolsリストを追加
  - _要件: 3.5, 3.6, 3.7, 3.8_

- [x] 7. 通貨の並び替え機能を実装




  - ReorderablePriceListウィジェットを作成
  - ReorderableListView.builderを使用
  - 編集モードの切り替え機能を追加
  - ドラッグハンドルの表示/非表示を実装
  - _要件: 8.1, 8.2, 8.4, 8.7, 8.8_

- [x] 7.1 並び替えの永続性プロパティテストを作成


  - **Property 4: 並び替えの永続性**
  - **Validates: 要件 8.5, 8.6, 9.3**
  - 並び替え後、再起動しても順序が維持されることを確認

- [x] 7.2 並び替え中の操作制限プロパティテストを作成


  - **Property 8: 並び替え中の操作制限**
  - **Validates: 要件 8.7, 8.8**
  - 編集モード中、通常のタップ操作が無効化されることを確認

- [x] 8. PriceListBlocに並び替え機能を追加





  - ToggleReorderModeEventを追加
  - ReorderPricesEventを追加
  - 並び替えモードの状態管理を実装
  - カスタム順序の保存と読み込みを実装
  - _要件: 8.4, 8.5, 8.6, 8.7, 8.8_

- [x] 9. ローカルストレージに並び順を保存





  - StorageKeysにpriceListOrderキーを追加
  - LocalStorageを使用して並び順をJSON配列として保存
  - アプリ起動時に保存された順序を読み込み
  - _要件: 8.5, 8.6, 9.3, 9.4_

- [x] 9.1 ストレージ操作のエラーハンドリングプロパティテストを作成


  - **Property 9: ストレージ操作のエラーハンドリング**
  - **Validates: 要件 9.5**
  - ストレージ操作失敗時、デフォルト値を使用して動作を継続することを確認

- [x] 10. PriceListPageを更新して新機能を統合




  - 表示密度設定をSettingsBlocから取得
  - お気に入り状態をFavoritesBlocから取得
  - 並び替えモードのUI切り替えを実装
  - カスタム順序を適用してリストを表示
  - _要件: すべて_

- [x] 11. アクセシビリティ対応を実装





  - Semanticsウィジェットでセマンティックラベルを追加
  - 最小タップ領域（44x44ポイント）を確保
  - スクリーンリーダー対応のラベルを追加
  - _要件: 7.1, 7.2, 7.4_

- [x] 11.1 最小タップ領域プロパティテストを作成


  - **Property 6: 表示要素の最小サイズ**
  - **Validates: 要件 7.4**
  - すべての表示密度でタップ可能な要素が44x44ポイント以上であることを確認

- [x] 12. エラーハンドリングを実装





  - アイコン読み込み失敗時のプレースホルダー表示
  - ストレージ操作失敗時のデフォルト値使用
  - 並び替え操作失敗時のロールバック
  - エラーメッセージの表示
  - _要件: 8.9, 9.5_

- [x] 13. パフォーマンス最適化を実装




  - ListView.builderにitemExtentを指定
  - 一意のキー（ValueKey）を使用
  - constコンストラクタを可能な限り使用
  - アイコンのメモリキャッシュ設定を最適化
  - _要件: 6.1, 6.2_

- [x] 14. チェックポイント - すべてのテストが通ることを確認





  - すべてのテストを実行
  - 問題があれば修正
  - ユーザーに質問があれば確認

- [x] 15. 統合テストを作成




  - 価格一覧画面の完全なフローをテスト
  - 表示密度変更、お気に入り追加/削除、並び替え操作を含む
  - アプリ再起動後の状態確認

- [x] 16. ウィジェットテストを作成









  - PriceListItemの各表示密度でのテスト
  - CryptoIconのテスト
  - ReorderablePriceListのテスト
