# 要件定義書

## はじめに

価格一覧画面の改善により、ユーザーがより多くの情報を効率的に確認し、お気に入り管理をより直感的に行えるようにします。この改善は、既存のCrypto Watch Flutterアプリケーションの価格一覧機能を拡張するものです。

## 用語集

- **システム**: Crypto Watch Flutterアプリケーション
- **ユーザー**: アプリケーションを使用する人
- **価格一覧画面**: 複数の暗号通貨の価格を表示するメイン画面
- **通貨アイコン**: 各暗号通貨を視覚的に識別するためのロゴ画像（例：ビットコインのオレンジ色のBマーク）
- **ティッカーシンボル**: 暗号通貨の略称（例：BTC、ETH、ADA）
- **通貨名**: 暗号通貨の正式名称（例：Bitcoin、Ethereum、Cardano）
- **お気に入り**: ユーザーが選択して保存した暗号通貨のリスト
- **長押し**: タッチスクリーン上で要素を一定時間（通常500ms以上）タッチし続ける操作
- **表示密度**: 1画面に表示される銘柄の数
- **リストアイテム**: 価格一覧画面の各暗号通貨の表示要素
- **並び替え**: リスト内の通貨の表示順序を変更する操作

## 要件

### 要件1: 通貨アイコンの表示

**ユーザーストーリー**: ユーザーとして、各暗号通貨のアイコンを確認したい。そうすることで、通貨を視覚的に素早く識別できる。

#### 受入基準

1. WHEN 価格一覧画面が表示される THEN システムは各通貨のアイコン画像を表示する
2. WHEN 通貨アイコンが表示される THEN システムはアイコンをリストアイテムの左端に配置する
3. WHEN 通貨アイコンが表示される THEN システムは円形または角丸の枠内にアイコンを表示する
4. WHEN 表示密度が「標準」である THEN システムはアイコンサイズを40x40ピクセルで表示する
5. WHEN 表示密度が「コンパクト」または「最大」である THEN システムはアイコンサイズを32x32ピクセルで表示する
6. WHEN アイコン画像が取得できない THEN システムはティッカーシンボルの頭文字を含むプレースホルダーを表示する
7. WHEN アイコンが読み込まれる THEN システムはキャッシュを使用してパフォーマンスを最適化する

### 要件2: 表示密度の調整機能

**ユーザーストーリー**: ユーザーとして、1画面に表示される通貨の数を増やしたい。そうすることで、スクロールせずにより多くの銘柄を確認できる。

#### 受入基準

1. WHEN ユーザーが設定画面を開く THEN システムは表示密度の設定オプションを提供する
2. WHEN 表示密度設定が表示される THEN システムは「標準」「コンパクト」「最大」の3つのオプションを提供する
3. WHEN 「標準」モードが選択される THEN システムは1画面に3〜5銘柄を表示する
4. WHEN 「コンパクト」モードが選択される THEN システムは1画面に6〜8銘柄を表示する
5. WHEN 「最大」モードが選択される THEN システムは1画面に9〜12銘柄を表示する
6. WHEN 表示密度が変更される THEN システムはリストアイテムの高さとパディングを調整する
7. WHEN 表示密度設定が保存される THEN システムは次回起動時も同じ設定を使用する
8. WHEN コンパクトまたは最大モードである THEN システムはフォントサイズを適切に縮小する
9. WHEN 表示密度が変更される THEN システムは可読性を維持する

### 要件3: 長押しによるお気に入り追加

**ユーザーストーリー**: ユーザーとして、価格一覧画面で通貨を長押ししてお気に入りに追加したい。そうすることで、素早く直感的にお気に入り管理ができる。

#### 受入基準

1. WHEN ユーザーがリストアイテムを長押しする THEN システムは触覚フィードバック（バイブレーション）を提供する
2. WHEN 長押しが検出される THEN システムはお気に入り追加/削除のコンテキストメニューを表示する
3. WHEN 通貨がお気に入りに未登録である THEN システムは「お気に入りに追加」オプションを表示する
4. WHEN 通貨が既にお気に入りに登録されている THEN システムは「お気に入りから削除」オプションを表示する
5. WHEN ユーザーが「お気に入りに追加」を選択する THEN システムは通貨をお気に入りリストに追加する
6. WHEN ユーザーが「お気に入りから削除」を選択する THEN システムは確認なしで即座に削除する
7. WHEN お気に入り状態が変更される THEN システムはローカルストレージに変更を永続化する
8. WHEN お気に入り状態が変更される THEN システムはリストアイテムの表示を更新する（例：星アイコンの表示/非表示）
9. WHEN コンテキストメニューが表示される THEN システムはメニュー外をタップすると閉じる

### 要件4: お気に入り状態の視覚的表示

**ユーザーストーリー**: ユーザーとして、どの通貨がお気に入りに登録されているか一目で確認したい。そうすることで、お気に入り管理の状態を把握できる。

#### 受入基準

1. WHEN 通貨がお気に入りに登録されている THEN システムはリストアイテムに星アイコンを表示する
2. WHEN 星アイコンが表示される THEN システムはアイコンを塗りつぶした状態で表示する
3. WHEN 通貨がお気に入りに未登録である THEN システムは星アイコンを表示しない、または輪郭のみの星を表示する
4. WHEN お気に入り状態が変更される THEN システムはアニメーションで星アイコンの状態を変更する
5. WHEN 星アイコンが表示される THEN システムはアイコンをリストアイテムの右端に配置する

### 要件5: 表示密度とレイアウトの最適化

**ユーザーストーリー**: 開発者として、異なる表示密度でも情報が適切に表示されることを保証したい。そうすることで、ユーザー体験の一貫性を維持できる。

#### 受入基準

1. WHEN 表示密度が「標準」である THEN システムは通貨アイコン、ティッカーシンボル、通貨名、価格、変動率、お気に入りアイコンをすべて表示する
2. WHEN 表示密度が「コンパクト」である THEN システムは通貨アイコン、ティッカーシンボル、価格、変動率、お気に入りアイコンを表示し、通貨名を省略または小さく表示する
3. WHEN 表示密度が「最大」である THEN システムは通貨アイコン、ティッカーシンボル、価格、変動率のみを表示し、お気に入りアイコンを小さくする
4. WHEN リストアイテムが表示される THEN システムは表示密度に関わらず通貨アイコン、価格、変動率を常に表示する
5. WHEN フォントサイズが縮小される THEN システムは最小フォントサイズ（12sp）を下回らない

### 要件6: パフォーマンスの維持

**ユーザーストーリー**: ユーザーとして、表示銘柄数が増えてもアプリが高速に動作することを期待する。そうすることで、快適に使用できる。

#### 受入基準

1. WHEN 最大表示密度で12銘柄が表示される THEN システムは60FPSを維持する
2. WHEN ユーザーがリストをスクロールする THEN システムは遅延なくスムーズにスクロールする
3. WHEN 長押し操作が実行される THEN システムは500ms以内に触覚フィードバックを提供する
4. WHEN お気に入り状態が変更される THEN システムは200ms以内にUIを更新する
5. WHEN 表示密度が変更される THEN システムは1秒以内にレイアウトを再構築する

### 要件7: アクセシビリティの確保

**ユーザーストーリー**: ユーザーとして、視覚的な制約があってもアプリを使用したい。そうすることで、すべてのユーザーが機能にアクセスできる。

#### 受入基準

1. WHEN スクリーンリーダーが有効である THEN システムは各リストアイテムに適切なセマンティックラベルを提供する
2. WHEN お気に入りアイコンが表示される THEN システムは「お気に入りに登録済み」という音声説明を提供する
3. WHEN 長押し操作が利用できる THEN システムは代替アクセス方法（例：ダブルタップ）も提供する
4. WHEN 表示密度が最大である THEN システムは最小タップ領域（44x44ポイント）を維持する
5. WHEN コンテキストメニューが表示される THEN システムはキーボードナビゲーションをサポートする

### 要件8: 通貨の並び替え機能

**ユーザーストーリー**: ユーザーとして、価格一覧画面で通貨の表示順序を変更したい。そうすることで、自分の好みの順序で通貨を確認できる。

#### 受入基準

1. WHEN ユーザーが編集モードを有効にする THEN システムは各リストアイテムにドラッグハンドルを表示する
2. WHEN ユーザーがドラッグハンドルを長押しする THEN システムはリストアイテムをドラッグ可能な状態にする
3. WHEN ユーザーがリストアイテムをドラッグする THEN システムは視覚的なフィードバック（影、透明度変更）を提供する
4. WHEN ユーザーがリストアイテムを別の位置にドロップする THEN システムは新しい順序でリストを再配置する
5. WHEN 並び替えが完了する THEN システムは新しい順序をローカルストレージに保存する
6. WHEN アプリが起動する THEN システムは保存された順序でリストを表示する
7. WHEN 編集モードが有効である THEN システムは通常のタップ操作（詳細画面への遷移）を無効にする
8. WHEN ユーザーが編集モードを終了する THEN システムはドラッグハンドルを非表示にし、通常の操作を復元する
9. WHEN 並び替え中にエラーが発生する THEN システムは元の順序に戻し、エラーメッセージを表示する

### 要件9: データの永続化

**ユーザーストーリー**: 開発者として、ユーザーの設定とお気に入りを確実に保存したい。そうすることで、アプリ再起動後も設定が維持される。

#### 受入基準

1. WHEN お気に入りが追加または削除される THEN システムは変更を即座にローカルストレージに保存する
2. WHEN 表示密度設定が変更される THEN システムは設定をローカルストレージに保存する
3. WHEN 通貨の並び順が変更される THEN システムは新しい順序をローカルストレージに保存する
4. WHEN アプリが起動する THEN システムは保存されたお気に入りリスト、表示密度設定、並び順を読み込む
5. WHEN ストレージ操作が失敗する THEN システムは適切なエラーハンドリングを行い、デフォルト値を使用する
